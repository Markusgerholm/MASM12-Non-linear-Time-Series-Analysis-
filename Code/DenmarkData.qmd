---
title: "DenmarkData"
format: html
---

```{r}
setwd("..")
source("Code/DenmarkFunctions.r")
```

 

```{R}
#get all stations
stations <- get_stations()
head(stations)
```

```{R}
station_id <- "06041" #Skagen Fyr
params <- get_station_available_parameters(station_id)
print(params)

```

```{R}


# Get available parameters for the station
params <- c("temp_mean_past1h","wind_dir_past1h","wind_speed_past1h")

# Set datetime range (ISO 8601 UTC)
start_time <- "2024-01-01T00:00:00Z"
end_time   <- "2025-12-13T00:00:00Z"

# Fetch observations
observations <- get_observations_for_station(
  station_id = station_id,
  parameters = params,   # or subset of parameters
  start_dt   = start_time,
  end_dt     = end_time,
  limit      = 1000
)

head(observations)

```

```{r}
start <- 1
end <- 3000
df_den <- observations %>%
  mutate(observed = as.POSIXct(observed, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"))
df_den2425 <- df_den %>%
  filter(
    observed >= as.POSIXct("2024-01-01 00:00:00", tz = "UTC"),
    observed <= as.POSIXct("2025-08-31 23:59:59", tz = "UTC")
  )

df_den2 <- df_den2425[start:end,]
```

```{r}
wind_regime <- function(wd) {
  wd <- wd %% 360                      # wrap to [0,360)
  out <- rep(NA_character_, length(wd))

  out[wd >   0 & wd <=  90] <- "R1"
  out[wd >  90 & wd <= 180] <- "R2"
  out[wd > 180 & wd <= 270] <- "R3"
  out[wd > 270 & wd <  360] <- "R4"
  out[wd == 0]              <- "R4"    # 0 degrees treated as 360, so belongs to (270-360]

  factor(out, levels = c("R1","R2","R3","R4"))
}
```

```{r}
regime <- wind_regime(df_he$Vindriktning)
df_he$regime <- regime
df_he_R <- filter(df_he, regime == "R3")

# times where df_h is R1
t_R <- df_he_R$ts_utc

# keep those times in df_ä
df_temp <- df_f
df_x <- df_temp[df_temp$ts_utc %in% t_R, ]
idx_missing <- which(is.na(df_x$Lufttemperatur))  # TRUE for NA and NaN

#df_x[-idx_missing, ]
#df_he_R[-idx_missing, ]
mean(df_he_R$Vindhastighet)
```
